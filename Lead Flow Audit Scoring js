(function () {
  const ATE_CONST = true; // If you're using this somewhere

  function waitForFormAndInit() {
    const form = document.querySelector("form");
    if (!form) return setTimeout(waitForFormAndInit, 200);

    console.log("‚úÖ Custom JS loaded. Form found:", form);

    form.addEventListener("submit", async function (e) {
      e.preventDefault();
      console.log("üöÄ Form submitted. Capturing data...");

      const formData = new FormData(form);
      const data = {};
      formData.forEach((value, key) => {
        data[key] = value;
      });

      const params = new URLSearchParams(window.location.search);
      data.full_name = params.get("full_name") || "";
      data.email = params.get("email") || "";
      data.phone = params.get("phone") || "";

      try {
        const response = await fetch("https://webhook-processor-production-4089.up.railway.app/webhook/Lead-Flow-Audit-Score", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });

        const result = await response.json();
        console.log("üéØ Webhook response:", result);

        if (result.redirectUrl) {
          window.location.href = result.redirectUrl;
        } else {
          alert("Score not available. Please try again.");
        }
      } catch (err) {
        console.error("‚ùå Webhook error:", err);
        alert("There was a problem submitting your audit. Please try again.");
      }
    });
  }

  waitForFormAndInit();
})();
